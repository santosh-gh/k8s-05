trigger: none

pool:
  vmImage: 'ubuntu-latest'

variables:
- group: 'k8s-dev'
- name: namespace
  value: 'default'
- name: artifactName 
  value: 'helmchart'
- name: imageTag
  value: $(Build.BuildId)
- name: imageName
  value: 'order'

stages:
  - stage: Build
    displayName: Build and Publish
    jobs:
      - job: BuildPublishDockerImages
        displayName: Build Publish Docker Images
        steps:
          - task: DockerInstaller@0
            displayName: Install Docker
            inputs:
              dockerVersion: '17.09.0-ce'

          - template: appTemplates/build.yml
            parameters:
              acrServiceConnection: $(acrServiceConnection)
              imageName: $(imageName)
              dockerFilePath: '$(Build.sourcesdirectory)/app/order-service/Dockerfile'
              tag: $(imageTag)